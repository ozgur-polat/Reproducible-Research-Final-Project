---
title: "main"
author: "Erim Celen"
date: "5/7/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
library(readr)
library(tidyverse)
library(dplyr)
library(kableExtra)
library(caret)
library(nnet)
```

```{r message=FALSE, warning=FALSE, include=FALSE}
data <- read_csv("C:\\Users\\merim\\OneDrive\\Documents\\GitHub\\Reproducible-Research-Final-Project\\E0.csv")
```

```{r echo=FALSE}
table <- data %>% 
            summarise('Home Team Shots' = sum(HS), 
                      'Home Team Shots on Target' = sum(HST), 
                      'Away Team Shots' = sum(AS), 
                      'Away Team Shots on Target' = sum(AST)) %>% 
            pivot_longer(everything())

table <- table %>% 
            mutate(place = substr(name,1,4))

ggplot(table, aes(x=name, y=value, fill=place)) + 
  geom_bar(stat = "identity") +
  geom_text(aes(label = value)) +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        legend.title = element_blank())

```

```{r include=FALSE}
proportions <- as.data.frame(c("Home","Away")) %>% setNames(c("name"))
proportions$value <- c(round(table[2,2] / table[1, 2],4) * 100,round(table[4,2] / table[3, 2],4) * 100)
proportions$value = paste0('%', proportions$value)
```

```{r echo=FALSE}
proportions %>%
  kable(col.names = NULL,digits = 2,"html",row.names = FALSE,caption = "Percentage of Shots on Target") %>%
  kable_styling(font_size = 20,bootstrap_options = c("striped"))
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
data %>%
  group_by(Time) %>%
  tally(sort = T) %>%
  top_n(3) %>%
  kable(col.names = NULL,digits = 2,"html",row.names = FALSE,caption = "Most Played Game Hours") %>%
  kable_styling(font_size = 20,bootstrap_options = c("striped"))
```

```{r}
data %>% 
  mutate(FTR = as_factor(FTR)) %>%
  mutate(FTR = fct_relevel())
```

```{r}
#most crucial referees
data %>%    filter(HR >0 | AR > 0 | HY>0 | AY>0) %>% count(Referee)
```
```{r}
numeric_data <- data[, !sapply(data,is.character)]


#needs to updated not every file ends with 16th column
res <- cor(numeric_data[1:16])

corrplot::corrplot(res,type="lower",order='hclust',tl.srt = 45,tl.col = 'black')
```

```{r Model}
data$FTR <- as.factor(data$FTR)


index<- createDataPartition(data$FTR,p=.70,list = FALSE)

train <- data[index,]
test<- data[-index,]

train$FTR<-relevel(train$FTR,ref= "H")




multinom_mod<- multinom(FTR ~ . ,data = train[, !sapply(data,is.character)])


summary(multinom_mod)
```

